<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>寒战大卖-头像生成器</title>
    <style>
        @font-face {
            font-family: ws138;
            src: url('./resource/字魂138号-霸燃手书-3500常用字.ttf') format('truetype');
        }
    </style>
</head>
<body>
<div>
    <label for="name">请输入两个字：</label>
    <input id="name" maxlength="2">
</div>
<canvas width="640" height="640"></canvas>
<script>
    const generate = async function () {
        const canvas = document.querySelector("canvas");
        const ctx = canvas.getContext("2d");

        {
            const image = new Image();
            image.src = "./resource/头像模板-底图.png";
            await new Promise((resolve, reject) => {
                image.onload = () => {
                    resolve();
                };
            });
            ctx.drawImage(image, 0, 0);
        }

        {
            const FONT_SIZE = 290;
            ctx.font = `${FONT_SIZE}px ws138`;
            ctx.fillStyle = 'white';
            ctx.fillText(this.value[0] ?? '', 87, 205 + FONT_SIZE, 254);
            ctx.fillText(this.value[1] ?? '', 290, 205 + FONT_SIZE, 254);
        }

        {
            const image = new Image();
            image.src = "./resource/头像模板-黄字.png";
            await new Promise((resolve, reject) => {
                image.onload = () => {
                    resolve();
                };
            });
            ctx.drawImage(image, 0, 0);
        }
    };

    const inputElement = document.getElementById('name');
    inputElement.onkeyup = inputElement.onchange = generate;
    inputElement.value = '逗年';
    document.onreadystatechange = () => {
        generate.call(inputElement);
    };

</script>
</body>
</html>
